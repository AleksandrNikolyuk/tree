const parse = require('csv-parse/lib/sync');
const fs = require('fs')

const data = `Parent,Children
ActingSubstanceCalculationNormTypes,ClusterActingSubstanceCalculationNormTypes
ActingSubstances,PlantProtectionActingSubstances
AdministrativeUnits,Fields
AgroZones,ClimaticZones
AgroZones,CropAllocationSchemas
AgroZones,CropOptimalReseedingTerms
AgroZones,CropRotations
AgroZones,MonocultureMaxNumberOfRepetitions
AgroZones,SortHybridAgroZones
ArrayBuildingStrategies,LegalEntities
BiologyClasses,HarmfulObjectPassports
BiologyFamilies,HarmfulObjectPassports
BiologyGenuses,HarmfulObjectPassports
BiologyKingdoms,HarmfulObjectPassports
BiologyOrders,HarmfulObjectPassports
BiologyTypes,HarmfulObjectPassports
ChemicalElements,ChemicalElementFertilizerMeasures
ChemicalElements,ClusterBasicSoilAnalysisMethodByChemicalElements
ChemicalElements,CompoundActiveSubstances
ChemicalElements,CropCharacteristicsByChemicalElements
ChemicalElements,FertilizerAdjustmentFactorApplicationMethods
ChemicalElements,FertilizerAdjustmentFactorMineralizationWithBiodestractors
ChemicalElements,FertilizerAdjustmentFactorMineralizationWithoutBiodestractors
ChemicalElements,FertilizerAdjustmentFactorSoilPHs
ChemicalElements,FertilizerAdjustmentFactorSoilTextures
ChemicalElements,FertilizerAdjustmentFactorsOrganicMatters
ChemicalElements,FertilizerAdjustmentFactorsSoilPhosphoruses
ChemicalElements,FertilizerChemicalElements
ChemicalElements,SoilAnalysisMethodSoilNutritionLevelByChemicalElements
ChemicalElements,SoilNutritionLevelBasicMethodRecalculationCoefficients
ClimaticZones,ClimaticZonePhotosyntheticallyActiveRadiations
ClimaticZones,ClimaticZoneSortHybridWeightRatios
ClimaticZones,Fields
ClimaticZones,SortHybridClimaticZones
Clusters,AdditionalOperationFuelConsumptionNorms
Clusters,ClusterActingSubstanceCalculationNormTypes
Clusters,ClusterBasicSoilAnalysisMethodByChemicalElements
Clusters,ClusterDeposits
Clusters,ClusterLegalEntities
Clusters,ClusterLimingMaterialNormTypes
Clusters,ClusterMassiveCreatingLimitDistances
Clusters,CropOperationStageTechnicalMaps
Clusters,CropRealizationCosts
Clusters,DependentPays
Clusters,ElevatorServiceCosts
Clusters,FertilizerNitrogenSchemas
Clusters,GeoZones
Clusters,HiredOperationCosts
Clusters,HitchModelFuelConsumptionMetrics
Clusters,LocalIntroductionQuantities
Clusters,MachineryOperationStageTechnicalMaps
Clusters,OwnHitchOperationCosts
Clusters,ResponsibilityAreaClusters
Clusters,SeedBalances
Clusters,SeedGrowthNumberForAgronoms
Colors,Crops
Colors,GradationLevels
Colors,SoilAnalysisMethodSoilNutritionLevelByChemicalElements
Colors,SoilDensityCategories
ContainerCapacities,PlantProtectionPassports
ContainerTypes,PlantProtectionPassports
Countries,PlantProtectionManufacturers
CropCalendarOperations,CropCalendarOperationByPreviousCrops
CropCultivatingNumbers,CropMicroelementSystemPreparations
CropGrowthPhasePlantProtectionUsages,CropGrowthPhaseProcessingKinds
CropGrowthPhases,CropGrowthPhaseArisingCalendarPeriods
CropGrowthPhases,CropGrowthPhasePlantProtectionUsages
CropGrowthPhases,FertilizerCropGrowthPhases
CropGrowthPhases,MeasureLimitExecutionTerms
CropProcessingKinds,CropGrowthPhaseProcessingKinds
CropProcessingKinds,MeasureTypes
CropQualityGroups,CropQualityGroupStandards
CropRipenessGroups,SortHybrids
CropRotationLinks,CropRotationLinkPriorities
CropRotationSchemes,CropRotationSchemeItems
CropRotationTypes,CropAllocationSchemas
CropRotationTypes,CropRotations
Crops,AdditionalOperationFuelConsumptionNorms
Crops,CropBiomassCalories
Crops,CropCalendarOperationByPreviousCrops
Crops,CropCalendarOperations
Crops,CropCharacteristicsByChemicalElements
Crops,CropComponentRatioYields
Crops,CropCultivatingNumbers
Crops,CropGrowthPhases
Crops,CropHarmfulObjectPlantProtectionSystems
Crops,CropHarmfulObjects
Crops,CropOperationStageTechnicalMaps
Crops,CropOptimalReseedingTerms
Crops,CropQualityGroups
Crops,CropQualityTypes
Crops,CropRealizationCosts
Crops,CropReproductions
Crops,CropRipenessGroups
Crops,CropRotationLinkPriorities
Crops,CropRotations
Crops,CropRotationSchemeItems
Crops,CropShortCharacteristicTypes
Crops,CropSoilAgroChemicalCharacteristics
Crops,CropSoilAgroPhysicCharacteristics
Crops,CropSowingPurposes
Crops,CropSowingSchemes
Crops,CropSowingTermClassifications
Crops,CropStandardHumidities
Crops,CropStandardYields
Crops,CropTechnologyOperations
Crops,CropTranspirationCoefficients
Crops,CropVegetationPeriods
Crops,CropVegetationTypes
Crops,ElevatorServiceCosts
Crops,FertilizerNitrogenSchemas
Crops,FieldYields
Crops,MonocultureMaxNumberOfRepetitions
Crops,OperationChoiceFactors
Crops,OperationDependencyRules
Crops,PlantProtectionAftereffectPeriods
Crops,SeedBalances
Crops,SeedGrowthNumberForAgronoms
Crops,SeedTreatmentCosts
Crops,SeedTreatments
Crops,SoilTreatmentSchemes
Crops,SortHybridCosts
Crops,SortHybrids
ElevatorServices,ElevatorServiceCosts
ExpenseArticles,ExpenseArticleGroups
ExpenseGroups,ExpenseArticleGroups
FertilizerAggregateStates,Fertilizers
FertilizerAggregateStates,OperationChoiceFactors
FertilizerApplicationMethods,OperationChoiceFactors
FertilizerDirections,Fertilizers
FertilizerDirections,MeasureTypes
FertilizerGroups,Fertilizers
FertilizerGroups,OperationChoiceFactors
FertilizerNitrogenApplicationMethodGroups,FertilizerNitrogenApplicationMethods
FertilizerNitrogenApplicationMethodGroups,MeasureTypes
FertilizerNitrogenSchemas,FertilizerNitrogenSchemaVariants
FertilizerNitrogenSchemaVariantCharacteristics,FertilizerCropGrowthPhases
FertilizerNitrogenSchemaVariants,FertilizerNitrogenSchemaVariantCharacteristics
Fertilizers,FertilizerChemicalElements
Fertilizers,FertilizerCosts
Fertilizers,FertilizerMeasureFertilizers
Fertilizers,FertilizerNitrogenSchemaVariantCharacteristics
Fertilizers,FieldFertilizerApplications
Fertilizers,MicroelementPreparations
Fertilizers,OperationChoiceFactors
Fertilizers,SeedTreatmentCompositions
FieldHarmfulObjectSurveyActs,FieldHarmfulObjectSurveyActSamples
FieldPurposes,FieldPurposeChanges
FieldPurposes,LocalIntroductionQuantities
FieldSoilCharacteristicSurveyActs,FieldSoilCharacteristicSurveyActSamples
Fields,FieldAreaChanges
Fields,FieldAssignments
Fields,FieldFertilizerApplications
Fields,FieldFertilizerDeposits
Fields,FieldHarmfulObjectSurveyActs
Fields,FieldLimingMaterials
Fields,FieldPerformancePoints
Fields,FieldPlantProtectionApplications
Fields,FieldPurposeChanges
Fields,FieldSoilCharacteristicSurveyActs
Fields,FieldSoilTypeAggregateSizeDistributionClasses
Fields,FieldSortHybridApplications
Fields,FieldYields
Fields,HitchModelsProductivityByYears
Fields,MaterialValuesStorageRoutes
Fields,OperationExecutionHistoryOnFields
Fields,ResponsibilityAreaFields
Fields,StructuralPositionObjects
Fields,YieldHistoricalDataByYears
FieldWorkTypes,CropCalendarOperations
FuelTypes,FuelCosts
FuelTypes,HitchModelFuelConsumptionMetrics
FuelTypes,MachineryInstances
FuelTypes,OperationTypePerformanceNorms
GeoZones,FieldAssignments
GeoZones,ResponsibilityAreaGeoZones
GeoZones,StructuralPositionObjects
HarmfulObjectPassports,CropHarmfulObjects
HarmfulObjects,CropHarmfulObjectPlantProtectionSystems
HarmfulObjects,FieldHarmfulObjectSurveyActSamples
HarmfulObjects,HarmfulObjectPassports
HarmfulObjects,SortHybridFirmnessToHarmfulObjectRates
HarmfulObjectTypeDistributionDegrees,FieldHarmfulObjectSurveyActSamples
HarmfulObjectTypes,HarmfulObjects
HarmfulObjectTypes,HarmfulObjectTypeDistributionDegrees
HarmfulObjectTypes,PlantProtectionGroups
HitchModelChoiceFactors,HitchModelChoiceFactorPriorities
HitchModels,CropHitchModels
HitchModels,HitchModelElements
HitchModels,HitchModelFuelConsumptionMetrics
HitchModels,HitchModelPreparationMetrics
HitchModels,HitchModelsProductivityByYears
HitchModels,HitchModelTransportationCostMetrics
HitchModels,OperationExecutionHistoryOnFields
HitchModels,OwnHitchOperationCosts
HitchModels,TransportingMetricHitchModels
LegalEntities,ClusterLegalEntities
LegalEntities,FieldAssignments
LegalEntities,LegalEntitySortHybridBalances
LegalEntities,MachineryInstances
LegalEntities,SeedBalances
LegalEntities,StructuralPositions
LimingMaterialNormTypes,ClusterLimingMaterialNormTypes
MachineryEmployments,HitchModelTransportationCostMetrics
MachineryGroups,MachinerySubGroups
MachineryInstances,MachineryInstanceProductivities
MachineryManufacturers,MachineryModels
MachineryModels,HitchModelElements
MachineryModels,MachineryInstances
MachineryPreparations,HitchModelPreparationMetrics
MachineryPurposes,MachineryModels
MachinerySections,MachineryGroups
MachinerySources,OperationTypes
MachinerySubGroups,MachineryModels
MassiveFormationTypes,GeoZones
MaterialValuesStorages,MaterialValuesStorageRoutes
MeaningfulCharacteristics,CropQualityGroups
MeaningfulCharacteristics,Crops
MeasureDepths,OperationChoiceFactors
MeasureDepths,SoilTreatmentSchemes
MeasureKinds,MeasureTypes
MeasureTypes,CropTechnologyOperations
MeasureTypes,FertilizerMeasureFertilizers
MeasureTypes,FertilizerNitrogenSchemaVariantCharacteristics
MeasureTypes,MeasureLimitExecutionTerms
MeasureTypes,OperationChoiceFactors
MeasureTypes,SoilTreatmentSchemes
MeasureUnits,ClusterMassiveCreatingLimitDistances
MeasureUnits,CompoundActiveSubstances
MeasureUnits,Crops
MeasureUnits,ElevatorServiceCosts
MeasureUnits,FertilizerChemicalElements
MeasureUnits,Fertilizers
MeasureUnits,FieldSortHybridApplications
MeasureUnits,FuelTypes
MeasureUnits,MeasureUnitExchanges
MeasureUnits,OperationTypes
MeasureUnits,PhysicalTypes
MeasureUnits,PlantProtectionCosts
MeasureUnits,PlantProtections
MeasureUnits,QualityTypes
MeasureUnits,SeedBalances
MeasureUnits,SeedGrowthNumberForAgronoms
MeasureUnits,SoilAgroChemicalCharacteristics
MeasureUnits,SoilCharacteristics
MeasureUnits,SortHybridCosts
MeasureUnits,SortHybrids
MeasureUnits,SowingSchemes
MeasureUnits,VegetationTypes
MicroelementPreparations,CropMicroelementSystemPreparations
MicroelementPreparations,InformationMicroelementPreparations
MicroelementSystems,CropCultivatingNumbers
MicroFertilizerTargetApplications,Fertilizers
NomenclatureGroups,SupplyTerms
OperationalRightTypes,OperationalRights
OperationGroupDependencies,OperationTypeDependencies
OperationGroups,OperationTypes
OperationPurposes,OperationTypes
OperationSigns,OperationSubTypes
OperationStageTechnicalMaps,CropCalendarOperations
OperationStageTechnicalMaps,CropOperationStageTechnicalMaps
OperationStageTechnicalMaps,MachineryOperationStageTechnicalMaps
OperationStageTechnicalMaps,SoilTreatmentSchemes
OperationSubTypes,CropCalendarOperations
OperationSubTypes,OperationChoiceFactors
OperationSubTypes,OperationDependencyRules
OperationTypeDependencies,OperationDependencyRules
OperationTypes,AdditionalOperationFuelConsumptionNorms
OperationTypes,CropHitchModels
OperationTypes,DependentPays
OperationTypes,HiredOperationCosts
OperationTypes,HitchModelChoiceFactorPriorities
OperationTypes,HitchModelFuelConsumptionMetrics
OperationTypes,HitchModelsProductivityByYears
OperationTypes,OperationExecutionHistoryOnFields
OperationTypes,OperationSubTypes
OperationTypes,OperationTypePerformanceNorms
OperationTypes,OwnHitchOperationCosts
PharmaceuticalForms,PlantProtectionPharmaceuticalForms
PhysicalTypes,SortHybridPhysicals
PlantProtectionGroups,PlantProtections
PlantProtectionManufacturers,PlantProtectionPassports
PlantProtectionPassports,PlantProtectionActingSubstances
PlantProtectionPassports,PlantProtectionAftereffectPeriods
PlantProtectionPassports,PlantProtectionPharmaceuticalForms
PlantProtectionSystemNumbers,CropHarmfulObjectPlantProtectionSystems
PlantProtections,FieldPlantProtectionApplications
PlantProtections,InformationPlantProtections
PlantProtections,OperationChoiceFactors
PlantProtections,PlantProtectionCosts
PlantProtections,PlantProtectionPassports
PlantProtections,SeedTreatmentCompositions
ProcessingNumbers,CropCultivatingNumbers
ProcessingNumbers,CropGrowthPhaseProcessingKinds
ProcessStageSteps,OperationalRights
ProcessStageSteps,PlanningProcessApprovalHierarchies
ProcessStages,ProcessStageSteps
QualityTypes,CropQualityGroupStandards
QualityTypes,CropQualityTypes
QualityTypes,SortHybridQualities
RegionalDirections,GeoZones
Reproductions,CropReproductions
Reproductions,SeedBalances
Reproductions,SeedGrowthNumberForAgronoms
Reproductions,SortHybridCosts
ResistanceFactors,SortHybridResistanceFactors
Restrictions,HarmfulObjects
Restrictions,SoilAgroChemicalCharacteristics
Restrictions,SoilCharacteristics
RestrictionTypes,Restrictions
Roles,OperationalRights
Roles,PlanningProcessApprovalHierarchies
SeedOrigins,SeedBalances
SeedPurposes,SeedBalances
SeedTreatmentSites,SeedTreatmentCosts
SeedTreatments,SeedTreatmentCompositions
ShortCharacteristicTypes,CropShortCharacteristicTypes
ShortCharacteristicTypes,SortHybridShortCharacteristics
SoilAggregateSizeDistributionClasses,FertilizerAdjustmentFactorSoilTextures
SoilAggregateSizeDistributionClasses,FieldSoilTypeAggregateSizeDistributionClasses
SoilAgroChemicalCharacteristics,CropSoilAgroChemicalCharacteristics
SoilAgroChemicalCharacteristics,GradationLevels
SoilAgroChemicalCharacteristics,SoilAnalysisMethodSoilNutritionLevelByChemicalElements
SoilAnalysisMethods,ClusterBasicSoilAnalysisMethodByChemicalElements
SoilAnalysisMethods,GradationLevels
SoilAnalysisMethods,SoilAnalysisMethodSoilNutritionLevelByChemicalElements
SoilAnalysisMethods,SoilNutritionLevelBasicMethodRecalculationCoefficients
SoilCharacteristicClassifications,FieldSoilCharacteristicSurveyActSamples
SoilCharacteristicGradationLevels,FieldSoilCharacteristicSurveyActSamples
SoilCharacteristicGradationLevels,GradationLevels
SoilCharacteristicGradationTypes,SoilAgroChemicalCharacteristics
SoilCharacteristicGradationTypes,SoilCharacteristicGradationLevels
SoilCharacteristics,CropSoilAgroPhysicCharacteristics
SoilCharacteristics,FieldSoilCharacteristicSurveyActSamples
SoilCharacteristics,SoilCharacteristicClassifications
SoilCharacteristics,SoilCharacteristicNorms
SoilCharacteristicTypes,SoilAgroChemicalCharacteristics
SoilNutritionLevels,FertilizerAdjustmentFactorsSoilPhosphoruses
SoilNutritionLevels,FertilizerNitrogenNutrientLevelAdjustmentFactors
SoilNutritionLevels,SoilAnalysisMethodSoilNutritionLevelByChemicalElements
SoilNutritionLevels,SoilNutritionLevelBasicMethodRecalculationCoefficients
SoilSalinityTypes,GradationLevels
SoilTypeFertilityGroups,CropStandardYields
SoilTypeFertilityGroups,SoilTypes
SoilTypes,FieldSoilCharacteristicSurveyActSamples
SoilTypes,FieldSoilTypeAggregateSizeDistributionClasses
SoilTypes,SoilCharacteristicNorms
SortHybrids,SeedGrowthNumberForAgronoms
SortHybrids,SortHybridAgroZones
SortHybrids,SortHybridClimaticZones
SortHybrids,SortHybridFirmnessToHarmfulObjectRates
SortHybrids,SortHybridFirmnessToMonocultureRates
SortHybrids,SortHybridPhysicals
SortHybrids,SortHybridQualities
SortHybrids,SortHybridResistanceFactors
SortHybrids,SortHybridShortCharacteristics
SortHybrids,SortHybridSowingSchemes
SortHybrids,SortHybridSowingTerms
SortHybrids,SortHybridVegetations
SortHybridTypes,CropCultivatingNumbers
SortHybridTypes,CropGrowthPhaseProcessingKinds
SortHybridTypes,CropHarmfulObjectPlantProtectionSystems
SortHybridTypes,SortHybrids
SortHybridWeightRatios,ClimaticZoneSortHybridWeightRatios
Sorts,FieldSortHybridApplications
Sorts,LegalEntitySortHybridBalances
Sorts,SeedBalances
Sorts,SortHybridCosts
Sorts,SortHybrids
Sorts,YieldHistoricalDataByYears
SowingPurposes,CropSowingPurposes
SowingSchemes,CropSowingSchemes
SowingSchemes,SortHybridSowingSchemes
SowingTermClassifications,CropSowingTermClassifications
SowingTerms,SortHybridSowingTerms
SowingWays,Crops
SowingWays,OperationChoiceFactors
StructuralPositions,ResponsibilityAreaClusters
StructuralPositions,ResponsibilityAreaFields
StructuralPositions,ResponsibilityAreaGeoZones
StructuralPositions,StructuralPositionObjects
StructuralPositions,UserStructuralPositions
Users,SeedGrowthNumberForAgronoms
Users,UserStructuralPositions
VegetationTypes,CropVegetationTypes
VegetationTypes,SortHybridVegetations`;


const results = parse(data, {
    columns: true,
    skip_empty_lines: true
});

const unique_parents = [...new Set(results.map(item => item.Parent))];

const top_parents = unique_parents.filter(root => {
    return results.some(item => item.Parent === root);
});

const getChilds = (parent) => {
    return results.filter(item => {
        return item.Parent === parent;
    });
}

const getRecursiveChilds = (parent) => {

    let childs = getChilds(parent);
    if (childs.length > 0) {
        childs = childs.map(child => getRecursiveChilds(child.Children));
    }

    return ({
        title: parent,
        childs: childs
    });
}

const result = top_parents.map(getRecursiveChilds);
fs.writeFile('tree.json', JSON.stringify(result), function (err) {
    if (err) throw err
    console.log('File created')
})
